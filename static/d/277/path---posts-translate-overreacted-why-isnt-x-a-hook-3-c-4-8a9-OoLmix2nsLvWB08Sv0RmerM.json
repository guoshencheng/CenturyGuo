{"data":{"markdownRemark":{"html":"<blockquote>\n<p>æœ¬æ–‡å‡ºè‡ª<a href=\"https://overreacted.io/\">overreacted</a>ï¼Œè¿™æ˜¯<a href=\"https://mobile.twitter.com/dan_abramov\">Dan Abramov</a>å†™çš„åšå®¢ï¼Œæˆ‘è§‰å¾—å¯¹å¾ˆæœ‰ç”¨æ‰€ä»¥ç‰¹æ„åšäº†è¿™ä¸ªç¿»è¯‘<a href=\"/posts/overreacted\">ç³»åˆ—</a>ï¼ŒåŸæ–‡é“¾æ¥è¯·æŸ¥çœ‹<a href=\"https://overreacted.io/why-isnt-x-a-hook/\">è¿™é‡Œ</a></p>\n</blockquote>\n<p>è‡ªä»ç¬¬ä¸€ä¸ªæ‹¥æœ‰<a href=\"https://reactjs.org/hooks\">React Hooks</a>çš„Reactçš„alphaç‰ˆæœ¬å‘å¸ƒä¹‹åã€‚ä¸æ–­åœ°ä¼šæœ‰äººæå‡ºä¸€äº›ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜: \"ä¸ºä»€ä¹ˆ <em>æŸä¸ªAPI</em> ä¸åšæˆHook\"ã€‚</p>\n<p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ï¼Œç°å·²ç»æœ‰çš„æ˜¯ä»¥ä¸‹è¿™äº›Hook:</p>\n<ul>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usestate\"><code class=\"language-text\">useState()</code></a> è®©ä½ èƒ½å¤Ÿå®šä¹‰ç»„ä»¶å†…çŠ¶æ€</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#useeffect\"><code class=\"language-text\">useEffect()</code></a> è®©ä½ èƒ½å¤Ÿå®šä¹‰ä¸€äº›Effect</li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#usecontext\"><code class=\"language-text\">useContext()</code></a> è®©ä½ èƒ½å¤Ÿè¯»å–contextä¸­çš„å€¼</li>\n</ul>\n<p>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€äº›APIï¼Œæ¯”å¦‚<code class=\"language-text\">React.memo()</code>å’Œ<code class=\"language-text\">&lt;Context.Provider&gt;</code>ï¼Œè¿™äº›è¿˜<em>æ²¡æœ‰</em>åšæˆHooksã€‚\nBut there are some other APIs, like <code class=\"language-text\">React.memo()</code> and <code class=\"language-text\">&lt;Context.Provider&gt;</code>, that are <em>not</em> Hooks. Commonly proposed Hook versions of them would be <em>noncompositional</em> or <em>antimodular</em>. This article will help you understand why.</p>\n<p><strong>å¤‡æ³¨ï¼šè¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©é‚£äº›å¯¹APIå†…éƒ¨æ„Ÿå…´è¶£çš„äººæ›´æ·±åº¦çš„ç†è§£Reactçš„APIã€‚å¦‚æœåªæ˜¯ä¸ºäº†åœ¨ç°å®ç”Ÿäº§ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦å…³å¿ƒè¿™äº›</strong></p>\n<hr>\n<p>è¿™é‡Œæœ‰ä¸¤ç‚¹æˆ‘ä»¬æœŸæœ›React APIèƒ½å¤Ÿä¿æŒçš„:</p>\n<ol>\n<li>\n<p><strong>å¯æ•´åˆæ€§</strong>: <a href=\"https://reactjs.org/docs/hooks-custom.html\">è‡ªå®šä¹‰Hooks</a>æ˜¯æˆ‘ä»¬é˜ŸHooks API å¯¹æœŸå¾…çš„åŠŸèƒ½ç‚¹ã€‚æˆ‘ä»¬æœŸæœ›å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ é¢‘ç¹çš„åˆ›å»ºä»–ä»¬è‡ªå·±çš„Hookï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯æ‰€æœ‰äººéƒ½èƒ½å¤Ÿ<a href=\"https://overreacted.io/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem\">æ­£ç¡®çš„</a>ä½¿ç”¨Hooks</p>\n</li>\n<li>\n<p><strong>è°ƒè¯•ä½“éªŒ</strong>: å³ä½¿åº”ç”¨åœ¨ä¸æ–­å˜å¤§ï¼Œæˆ‘ä»¬æœŸæœ›bugè°ƒè¯•ä¾ç„¶æ˜¯<a href=\"https://overreacted.io/the-bug-o-notation/\">ç®€å•çš„</a>ã€‚Reactäº®ç‚¹ä¹‹ä¸€å°±æ˜¯å½“ä½ å‘ç°é¡µé¢ä¸Šæœ‰ä»€ä¹ˆé—®é¢˜çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡éå†Reactæ ‘æ¥æ‰¾åˆ°å‡ºé—®é¢˜çš„é‚£ä¸ªç»„ä»¶çš„çŠ¶æ€å€¼ã€‚</p>\n</li>\n</ol>\n<p>è¿™ä¸¤ç‚¹é™åˆ¶äº†æˆ‘ä»¬å¯¹Hookçš„å¯ä¸ºå’Œä¸å¯ä¸ºã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­å§ã€‚</p>\n<hr>\n<h2>ä¸€ä¸ªå·²ç»å­˜åœ¨çš„Hook: <code class=\"language-text\">useState()</code></h2>\n<h3>å¯æ•´åˆæ€§</h3>\n<p>å¤šä¸ªè‡ªå®šä¹‰Hookåœ¨è°ƒç”¨<code class=\"language-text\">useState()</code>çš„æ—¶å€™ä¸ä¼šå†²çª:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// What happens here, stays here.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// What happens here, stays here.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useMyCustomHook1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useMyCustomHook2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æ¯æ·»åŠ ä¸€ä¸ªæ— æ¡ä»¶çš„<code class=\"language-text\">useState()</code>éƒ½æ˜¯å®‰å…¨çš„ã€‚ä½ ä¸ç”¨å…³å¿ƒå½“å‰ç»„ä»¶ä½¿ç”¨åˆ°çš„å…¶ä»–çš„è‡ªå®šä¹‰Hookæ˜¯ä¸æ˜¯å®šä¹‰äº†å…¶ä»–çš„çŠ¶æ€å˜é‡ã€‚ä½ ä¹Ÿä¸ç”¨æ‹…å¿ƒä½ ä¼šä¸å°å¿ƒæ›´æ–°å…¶ä»–çš„çŠ¶æ€ã€‚</p>\n<p><strong>å®¡åˆ¤ä¹¦</strong> âœ…<code class=\"language-text\">useState</code>æ²¡æœ‰è®©Reactå˜çš„æ›´åŠ è„†å¼±ã€‚</p>\n<h3>è°ƒè¯•ä½“éªŒ</h3>\n<p>Hookséå¸¸æœ‰ç”¨ï¼Œä½ å¯ä»¥å°†å˜é‡åœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">isMobile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Comment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">const</span> isMobile <span class=\"token operator\">=</span> width <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MOBILE_VIEWPORT</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> theme <span class=\"token operator\">=</span> <span class=\"token function\">useTheme</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>section className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">.</span>comment<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä½†å‡å¦‚æˆ‘ä»¬çš„ä»£ç å†™é”™äº†å‘¢ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè°ƒè¯•?</p>\n<p>å°±æ¯”å¦‚è¯´å‡å¦‚<code class=\"language-text\">theme.comment</code>ä¼ é€’åˆ°classçš„å€¼æœ‰é—®é¢˜ã€‚æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè°ƒè¯•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä½“ä¸­å¤§æ–­ç‚¹æˆ–è€…è¾“å‡ºä¸€äº›æ—¥å¿—ã€‚</p>\n<p>ä½ å¯èƒ½ä¼šçœ‹åˆ°<code class=\"language-text\">theme</code>çš„å€¼ä¸å¯¹ï¼Œä½†æ˜¯<code class=\"language-text\">width</code>å’Œ<code class=\"language-text\">isMobile</code>æ˜¯æ­£ç¡®çš„ã€‚è¿™å°±è®©æˆ‘ä»¬çŸ¥é“äº†é—®é¢˜å‡ºåœ¨<code class=\"language-text\">useTheme()</code>ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯<code class=\"language-text\">width</code>æœ¬èº«å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœæœ‰é—®é¢˜é‚£æˆ‘ä»¬å°±è¦å»æŸ¥çœ‹ä¸€ä¸‹<code class=\"language-text\">useWindowWidth()</code>ã€‚</p>\n<p><strong>ç®€å•ç›´æ¥çš„çœ‹ä¸€ä¸‹è¿™äº›å˜é‡çš„å€¼æˆ‘ä»¬å°±èƒ½å¤ŸçŸ¥é“æ˜¯å“ªä¸ªHookäº§ç”Ÿçš„bug</strong> æˆ‘ä»¬ä¸ç”¨å»æŸ¥çœ‹æ‰€æœ‰Hookçš„å®ç°ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥\"æ·±å…¥\"åˆ°å“ªä¸ªæœ‰é—®é¢˜çš„Hookä¸­ï¼Œé‡å¤æ£€æŸ¥å“ªä¸ªå€¼äº§ç”Ÿçš„é—®é¢˜ã€‚</p>\n<p>è¿™åœ¨Hooksçš„æ·±åº¦å¢åŠ çš„æ—¶å€™å˜å¾—éå¸¸é‡è¦ã€‚å‡å¦‚æˆ‘ä»¬çš„è‡ªå®šä¹‰HookåµŒå¥—äº†ä¸‰å±‚ï¼Œæ¯å±‚éƒ½ç”¨äº†ä¸åŒçš„è‡ªå®šä¹‰Hookã€‚é‚£ä¹ˆåªæ£€æŸ¥<strong>ä¸‰ä¸ªåœ°æ–¹</strong>å’Œéœ€è¦æ£€æŸ¥æ½œåœ¨çš„<strong>3 + 3 * 3 + 3 * 3 * 3 = 39 ä¸ªåœ°æ–¹</strong>æ˜¯æœ‰ç€å·¨å¤§çš„<a href=\"https://overreacted.io/the-bug-o-notation/\">å·®è·</a>çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code class=\"language-text\">useState()</code>æ˜¯ä¸ä¼šåœ¨Hookå’Œç»„ä»¶ä¹‹é—´äº’ç›¸å½±å“çš„ã€‚æœ‰é—®é¢˜çš„æ•°æ®åªæ˜¯åœ¨Hookçš„æœ€åè¢«é—ç•™ä¸‹æ¥ï¼Œå°±å¥½åƒæ˜¯ç”³æ˜ä¸€ä¸ªå˜é‡ä¸€æ ·ã€‚ğŸ›</p>\n<p><strong>å®¡åˆ¤ä¹¦:</strong> âœ… <code class=\"language-text\">useState()</code>ä¸ä¼šè®©æˆ‘ä»¬çš„ä»£ç é€»è¾‘å…³ç³»æ··ä¹±ã€‚æˆ‘ä»¬å¯ä»¥é¡ºè—¤æ‘¸ç“œçš„æ‰¾åˆ°è¿™ä¸ªbugã€‚</p>\n<hr>\n<h2>è¿™ä¸æ˜¯Hook: <code class=\"language-text\">useBailout()</code></h2>\n<p>æˆ‘ä»¬åœ¨åšä¼˜åŒ–çš„æ—¶å€™ï¼Œç»„ä»¶å¯ä»¥ä½¿ç”¨Hookè®©é‡æ–°æ¸²æŸ“ä¸æ˜¯é‚£ä¹ˆé¢‘ç¹ã€‚</p>\n<p>å®ç°è¿™ä¸ªæ•ˆæœçš„ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨<a href=\"https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo\"><code class=\"language-text\">React.memo()</code></a>æ¥åŒ…è£¹æ•´ä¸ªç»„ä»¶ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨åœ¨äºï¼Œå½“propså’Œè€çš„propsæµ…æ¯”è¾ƒç›¸ç­‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸è®©ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å°±å¥½åƒæˆ‘ä»¬åœ¨ç±»å£°æ˜çš„ç»„ä»¶ä¸­ä½¿ç”¨<code class=\"language-text\">PureComponent</code>ä¸€æ ·ã€‚</p>\n<p><code class=\"language-text\">React.memo()</code>æ¥æ”¶ä¸€ä¸ªç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªç»„ä»¶:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>Button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p><strong>ä½†æ˜¯ ä¸ºä»€ä¹ˆä¸åšæˆHook?</strong></p>\n<p>æ— è®ºä½ æ€ä¹ˆç§°å‘¼ä»–<code class=\"language-text\">useShouldComponentUpdate()</code>, <code class=\"language-text\">usePure()</code>, <code class=\"language-text\">useSkipRender()</code>, or <code class=\"language-text\">useBailout()</code>, è¿™ä¸ªææ¡ˆå¤§æ¦‚ä½¿ç”¨åƒè¿™æ ·:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">Button</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> color <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// âš ï¸ Not a real API</span>\n  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevColor</span> <span class=\"token operator\">=></span> prevColor <span class=\"token operator\">!==</span> color<span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>button className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'button-'</span> <span class=\"token operator\">+</span> color<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>  \n      <span class=\"token constant\">OK</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä»¥ä¸Šçš„å˜ç§è¿˜æœ‰å¾ˆå¤š(æ¯”å¦‚<code class=\"language-text\">usePure()</code>)ï¼Œä½†æ˜¯å¹¿ä¹‰ä¸Šè¿˜æœ‰ä¸€äº›ç¼ºé™·ã€‚</p>\n<h3>å¯ç»„åˆæ€§</h3>\n<p>å°±ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æœŸæœ›å°†<code class=\"language-text\">useBailout()</code>æ”¾åˆ°æˆ‘ä»¬ä¸¤ä¸ªä¸åŒçš„è‡ªå®šä¹‰Hookä¸­:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">friendID</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isOnline<span class=\"token punctuation\">,</span> setIsOnline<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âš ï¸ Not a real API</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevIsOnline</span> <span class=\"token operator\">=></span> prevIsOnline <span class=\"token operator\">!==</span> isOnline<span class=\"token punctuation\">,</span> isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleStatusChange</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">status</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsOnline</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">.</span>isOnline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ChatAPI<span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">,</span> handleStatusChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> isOnline<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> setWidth<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// âš ï¸ Not a real API</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">useBailout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevWidth</span> <span class=\"token operator\">=></span> prevWidth <span class=\"token operator\">!==</span> width<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleResize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setWidth</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> handleResize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>é‚£ä¹ˆå½“æˆ‘ä»¬åœ¨åŒä¸€ä¸ªç»„ä»¶ä½¿ç”¨ä¸¤æ¬¡è¿™ä¸ªHookä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ChatLayout width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>FriendStatus isOnline<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'Typing...'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ChatLayout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šé‡æ–°æ¸²æŸ“å‘¢?</p>\n<p>å¦‚æœæ¯ä¸€ä¸ª<code class=\"language-text\">useBailout()</code>éƒ½èƒ½å¤Ÿè·³è¿‡é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆè¢«å…è®¸çš„<code class=\"language-text\">useWindowWidth()</code>æ›´æ–°æœ‰å¯èƒ½ä¼šé˜»ç¢<code class=\"language-text\">useFriendStatus()</code>çš„æ›´æ–°ï¼Œåä¹‹äº¦ç„¶ã€‚<strong>è¿™äº›Hookä¼šäº’ç›¸é˜»ç¢</strong>ã€‚</p>\n<p>è€Œä¸”ï¼Œå°±ç®—æ˜¯<code class=\"language-text\">useBailout()</code>åªæœ‰åœ¨æ‰€æœ‰çš„è°ƒç”¨éƒ½\"åŒæ„\"é˜»æ­¢ä¸€æ¬¡æ›´æ–°çš„æ—¶å€™æ‰é˜»æ­¢æ›´æ–°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code class=\"language-text\">ChatThread</code>åœ¨<code class=\"language-text\">isTyping</code>å±æ€§å˜æ›´çš„æ—¶å€™å°±ä¼šæ›´æ–°å¤±è´¥äº†ã€‚</p>\n<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåƒè¿™æ ·çš„è¯­æ³• <strong>ä¹‹åæ–°çš„è°ƒç”¨<code class=\"language-text\">useBailout()</code>çš„Hookè¢«åŠ å…¥åˆ°<code class=\"language-text\">ChatThread</code>ä¸­</strong>ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½\"åå¯¹\"åœ¨<code class=\"language-text\">useWindowWidth()</code>å’Œ<code class=\"language-text\">useFriendStatus()</code>ä¸­ä½¿ç”¨bailoutä¹‹ç±»çš„Hookã€‚</p>\n<p><strong>å®£åˆ¤ï¼š</strong> ğŸ”´ <code class=\"language-text\">useBailout()</code> æ‰“ç ´äº†å¯ç»„åˆæ€§çš„è§„åˆ™ã€‚å°†è¿™æ ·çš„HookåŠ å…¥åˆ°ç»„ä»¶ä¸­ï¼Œä¼šç ´åå…¶ä»–Hookä¸­çš„stateçš„æ›´æ–°ã€‚æˆ‘ä»¬æœŸæœ›æˆ‘ä»¬çš„APIèƒ½å¤Ÿæ›´åŠ <a href=\"https://overreacted.io/optimized-for-change/\">åšå›º</a>ï¼Œä½†æ˜¯è¿™ç§è¡Œä¸ºä¸ºä¹‹ç›¸åã€‚</p>\n<h3>è°ƒè¯•ä½“éªŒ</h3>\n<p>åƒ<code class=\"language-text\">useBailout()</code>è¿™ç±»çš„Hookåœ¨è°ƒè¯•æ–¹é¢çš„ä½“éªŒå¦‚ä½•?\nHow does a Hook like <code class=\"language-text\">useBailout()</code> affect debugging?</p>\n<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ä¾‹å­:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">ChatThread</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> friendID<span class=\"token punctuation\">,</span> isTyping <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> <span class=\"token function\">useWindowWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isOnline <span class=\"token operator\">=</span> <span class=\"token function\">useFriendStatus</span><span class=\"token punctuation\">(</span>friendID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ChatLayout width<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>FriendStatus isOnline<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>isOnline<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>isTyping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'Typing...'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ChatLayout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å°±æ¯”å¦‚è¯´<code class=\"language-text\">Typing...</code>è¿™ä¸ªæ–‡æœ¬ï¼Œå‡å¦‚ä¸ç®¡æˆ‘ä»¬çš„ä¸Šçº§å±æ€§å¦‚ä½•çš„å˜åŠ¨ï¼Œæ˜¾ç¤ºçš„éƒ½ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•è°ƒè¯•å®ƒ?</p>\n<p><strong>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨Reactä¸­é€šè¿‡ä»æ–‡æœ¬æ‰€åœ¨çš„ç»„ä»¶å‘ä¸Šå¯»æ‰¾å°±èƒ½è‡ªä¿¡çš„å›ç­”è¿™ä¸ªé—®é¢˜</strong>ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€æ¸²æŸ“è¿™ä¸ªç»„ä»¶çš„åœ°æ–¹<code class=\"language-text\">&lt;ChatThread isTyping={myVar} /&gt;</code>å¹¶æ£€æŸ¥<code class=\"language-text\">myVar</code>ç­‰ç­‰ï¼Œåªè¦é€å±‚å¯»æ‰¾ï¼Œä½ æˆ–è®¸ä¼šå‘ç°æœ‰çš„åœ°æ–¹çš„<code class=\"language-text\">shouldComponentUpdate()</code>æœ‰é—®é¢˜ï¼Œæˆ–è€…<code class=\"language-text\">isTyping</code>çš„å€¼å‘ä¸‹ä¼ é€’çš„æ—¶å€™æœ‰é—®é¢˜ã€‚é¡ºè—¤é­”æ€ªçš„å°±èƒ½å¤Ÿå®šä½åˆ°è¿™ä¸ªé—®é¢˜çš„æ‰€åœ¨ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬åŠ å…¥äº†<code class=\"language-text\">useBailout()</code>Hookï¼Œé™¤éä½ æ£€æŸ¥<em>æ‰€æœ‰çš„<code class=\"language-text\">ChatThread</code>å’Œå…¶è°ƒç”¨é“¾è·¯ä¸Šç»„ä»¶æ‰€ä½¿ç”¨çš„è‡ªå®šä¹‰Hook</em>ï¼Œä¸ç„¶ä½ å¯èƒ½è¿˜æ˜¯ä¸èƒ½ç¡®å®šä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œæ›´æ–°ã€‚å› ä¸ºç»„ä»¶çš„çˆ¶ç»„ä»¶ä¹Ÿå¯èƒ½ä½¿ç”¨è‡ªå®šä¹‰Hookï¼Œè¿™è®©<a href=\"https://overreacted.io/the-bug-o-notation/\">è°ƒè¯•å¤æ‚åº¦</a>ç–¯ç‹‚å¢é•¿ã€‚</p>\n<p>å°±å¥½åƒä½ åœ¨ä¸€ä¸ªæŠ½å±‰é‡Œé¢æ‰¾èºä¸åˆ€ï¼Œä½†æ˜¯æ¯ä¸ªæŠ½å±‰é‡Œé¢éƒ½æœ‰ä¸ªæ›´å°çš„æŠ½å±‰ï¼Œæ‰€ä»¥ä½ æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªå…”å­æ´åˆ°åº•æœ‰å¤šæ·±ã€‚</p>\n<p><strong>åˆ¤å†³ä¹¦:</strong> ğŸ”´ <code class=\"language-text\">useBailout()</code>è¿™ç±»Hookä¸ä»…ä»…ç ´åäº†å¯ç»„åˆæ€§åŸåˆ™ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜å¤§å¤§çš„å¢åŠ äº†è°ƒè¯•çš„å¤æ‚åº¦ - åœ¨æŸç§æƒ…å†µä¸‹ï¼Œç”šè‡³æ˜¯æˆæœ¬å¢é•¿çš„ã€‚</p>\n<hr>\n<p><code class=\"language-text\">useState()</code>æ˜¯æˆ‘ä»¬å·²ç»å‘å¸ƒçš„Hookï¼Œè€Œ<code class=\"language-text\">useBailout()</code>æ˜¯å¤§å®¶æ™®éå»ºè®®ä½†æˆ‘ä»¬æ•…æ„æ²¡æœ‰å°†è¿™ä¸ªåšæˆä¸€ä¸ªHookã€‚æˆ‘é€šè¿‡å¯ç»„åˆæ€§å’Œè°ƒè¯•ä½“éªŒè¿™ä¸¤ä¸ªåŸåˆ™æ¯”è¾ƒäº†ä»–ä»¬ï¼Œå¹¶è®¨è®ºäº†ä¸ºä»€ä¹ˆä»–ä»¬å…¶ä¸­çš„ä¸€ä¸ªæ˜¯å¯ä»¥å·¥ä½œçš„ï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ä¸èƒ½å¤Ÿå·¥ä½œçš„ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰æä¾›<code class=\"language-text\">memo()</code>æˆ–è€…<code class=\"language-text\">shouldComponentUpdate()</code>çš„\"Hookç‰ˆæœ¬\"ï¼Œä½†æ˜¯React<em>ç¡®å®</em>æä¾›äº†ä¸€ä¸ªåä¸º<a href=\"https://reactjs.org/docs/hooks-reference.html#usememo\"><code class=\"language-text\">useMemo()</code></a>çš„Hookã€‚å®ƒæä¾›äº†å·®ä¸å¤šçš„åŠŸèƒ½ï¼Œä½†æ˜¯ä½¿ç”¨æ–¹å¼ä¼šç¨æ˜¾ä¸åŒï¼Œè¿›è€Œé˜²æ­¢å¼€å‘è€…å å…¥ä¸Šè¿°çš„é™·é˜±ã€‚</p>\n<p><code class=\"language-text\">useBailout()</code>åªæ˜¯æˆ‘æåˆ°çš„ä¸åº”è¯¥è¢«ä½œä¸ºHookçš„ä¾‹å­ä¹‹ä¸€ã€‚è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„ - æ¯”å¦‚<code class=\"language-text\">useProvider()</code>, <code class=\"language-text\">useCatch()</code>, or <code class=\"language-text\">useSuspense()</code>ã€‚</p>\n<p>ä½ ç°åœ¨çŸ¥é“ä¸ºä»€ä¹ˆäº†ä¹ˆã€‚</p>\n<p><em>(æ‚„æ‚„å‘Šè¯‰ä½ : ç»„åˆæ€§... è°ƒè¯•ä½“éªŒ...)</em></p>","frontmatter":{"title":"ç¿»è¯‘: ä¸ºä»€ä¹ˆXä¸åšæˆHook","date":"26 January, 2019","tag":"translate,overreacted"},"excerpt":"æœ¬æ–‡å‡ºè‡ª overreacted ï¼Œè¿™æ˜¯ Dan Abramov å†™çš„åšå®¢ï¼Œæˆ‘è§‰å¾—å¯¹å¾ˆæœ‰ç”¨æ‰€ä»¥ç‰¹æ„åšäº†è¿™ä¸ªç¿»è¯‘ ç³»åˆ— ï¼ŒåŸæ–‡é“¾æ¥è¯·æŸ¥çœ‹ è¿™é‡Œ è‡ªä»ç¬¬ä¸€ä¸ªæ‹¥æœ‰ React Hooks çš„Reactçš„alphaâ€¦"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"translate-overreacted-why-isnt-x-a-hook"}}