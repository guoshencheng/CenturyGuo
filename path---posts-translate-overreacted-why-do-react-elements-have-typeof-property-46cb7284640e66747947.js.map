{"version":3,"sources":["webpack:///path---posts-translate-overreacted-why-do-react-elements-have-typeof-property-46cb7284640e66747947.js","webpack:///./.cache/json/posts-translate-overreacted-why-do-react-elements-have-typeof-property.json"],"names":["webpackJsonp","379","module","exports","data","markdownRemark","html","frontmatter","title","date","tag","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,gBAAkBC,KAAA,m0fAAqkeC,aAAgyCC,MAAA,iCAAAC,KAAA,oBAAAC,IAAA,2BAAoGC,aAAgBC,KAAA","file":"path---posts-translate-overreacted-why-do-react-elements-have-typeof-property-46cb7284640e66747947.js","sourcesContent":["webpackJsonp([99838320125203],{\n\n/***/ 379:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<blockquote>\\n<p>æœ¬æ–‡å‡ºè‡ª<a href=\\\"https://overreacted.io/\\\">overreacted</a>ï¼Œè¿™æ˜¯<a href=\\\"https://mobile.twitter.com/dan_abramov\\\">Dan Abramov</a>å†™çš„åšå®¢ï¼Œæˆ‘è§‰å¾—å¯¹å¾ˆæœ‰ç”¨æ‰€ä»¥ç‰¹æ„åšäº†è¿™ä¸ªç¿»è¯‘<a href=\\\"/posts/overreacted\\\">ç³»åˆ—</a>ï¼ŒåŸæ–‡é“¾æ¥è¯·æŸ¥çœ‹<a href=\\\"https://overreacted.io/why-do-react-elements-have-typeof-property/\\\">è¿™é‡Œ</a></p>\\n</blockquote>\\n<p>æƒ³è±¡ä¸€ä¸‹å¦‚æœä½ ç¼–å†™äº†ä¸‹é¢çš„ä¸€æ®µä»£ç </p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>marquee</span> <span class=\\\"token attr-name\\\">bgcolor</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>#ffa7c4<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>hi<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>marquee</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>äº‹å®ä¸Šä½ æ˜¯åœ¨è°ƒç”¨è¿™æ ·ä¸€ä¸ªå‡½æ•°:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\">React<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token comment\\\">/* type */</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">/* props */</span> <span class=\\\"token punctuation\\\">{</span> bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">/* children */</span> <span class=\\\"token string\\\">'hi'</span>\\n<span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p>è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä½ ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å«åšReactå…ƒç´ ã€‚Reactå¯ä»¥åœ¨ä¹‹åæ¸²æŸ“è¿™ä¸ªå…ƒç´ ï¼Œä½ çš„ç»„ä»¶ä¸€èˆ¬ä¼šè¿”å›è¿™ä¸ªå…ƒç´ çš„æ ‘å½¢ç»“æ„ã€‚</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// ğŸ§ è¿™æ˜¯ä¸ªä»€ä¹ˆ</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>å¦‚æœä½ ä½¿ç”¨è¿‡Reactï¼Œä½ å¯èƒ½ä¼šå¯¹<code class=\\\"language-text\\\">type</code>ï¼Œ<code class=\\\"language-text\\\">props</code>ï¼Œ<code class=\\\"language-text\\\">key</code>ï¼Œ<code class=\\\"language-text\\\">ref</code>è¿™äº›å±æ€§åå¾ˆç†Ÿæ‚‰ã€‚<strong>ä½†æ˜¯è¿™ä¸ª<code class=\\\"language-text\\\">$$typeof</code>æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿè€Œä¸”ä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ªSymbolç±»å‹çš„æ•°æ®</strong></p>\\n<p>è¿™åˆæ˜¯ä¸€ä¸ªä½ å…¶å®åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å¹¶ä¸éœ€è¦çŸ¥é“çš„Reactçš„çŸ¥è¯†ï¼Œä½†æ˜¯å½“ä½ çŸ¥é“äº†è¿™ä¸ªä¹‹åï¼Œä½ ä¼šè§‰å¾—è±ç„¶å¼€æœ—ã€‚è¿™ç¯‡æ–‡ç« ä¼šåŒ…å«ä¸€äº›æœ‰å…³å®‰å…¨çš„çŸ¥è¯†ã€‚å¯èƒ½æœ‰ä¸€å¤©ä½ ä¼šç¼–å†™ä½ è‡ªå·±çš„UIæ¡†æ¶ï¼Œä»Šå¤©è¿™äº›çŸ¥è¯†ä¼šå¯¹ä½ éå¸¸æœ‰ç”¨ã€‚æˆ‘ä¹Ÿå¸Œæœ›è¿™å¯¹ä½ ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>\\n<hr>\\n<p>åœ¨å®¢æˆ·ç«¯UIæ¡†æ¶æµè¡Œå¹¶åŠ ä¸Šä¸€äº›åŸºç¡€çš„é˜²å¾¡æªæ–½ä¹‹å‰ï¼Œå¤§å®¶æ™®éçš„åšæ³•æ˜¯ç»„ç»‡ä¸€ä¸ªhtmlä»£ç ï¼Œå¹¶æ’å…¥åˆ°domä¸­å»:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token keyword\\\">const</span> messageEl <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'message'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmessageEl<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'&lt;p>'</span> <span class=\\\"token operator\\\">+</span> message<span class=\\\"token punctuation\\\">.</span>text <span class=\\\"token operator\\\">+</span> <span class=\\\"token string\\\">'&lt;/p>'</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<p>è¿™æ ·åšä¸€èˆ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å‡å¦‚ä¸Šé¢çš„<code class=\\\"language-text\\\">messsage.text</code>æ˜¯åƒ<code class=\\\"language-text\\\">&#39;&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;&#39;</code>è¿™æ ·çš„å†…å®¹ã€‚<strong>ä½ ä¸ä¼šæ„¿æ„æŠŠæ‰€æœ‰çš„é™Œç”Ÿäººå‘é€çš„ä¿¡æ¯å…¨éƒ½æ¸²æŸ“åœ¨é¡µé¢ä¸Š</strong></p>\\n<p>(æœ‰è¶£çš„äº‹å®: å¦‚æœä½ åªä½¿ç”¨å®¢æˆ·ç«¯çš„æ¸²æŸ“ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª<a href=\\\"https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript\\\">è„šæœ¬</a>ä¸ä¼šè®©ä½ è¿è¡Œè¿™äº›javascriptã€‚ä½†æ˜¯åˆ«è®©è¿™äº›è®©ä½ å¯¹å®‰å…¨é—®é¢˜è¶Šæ¥è¶Šä¸æ˜æ„Ÿ)ã€‚</p>\\n<p>ä¸ºäº†é˜²æ­¢è¿™ç§æ”»å‡»ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨çš„APIæ¯”å¦‚<code class=\\\"language-text\\\">document.createTextNode()</code>æˆ–è€…<code class=\\\"language-text\\\">textContent</code>ï¼Œè¿™ç§å‡½æ•°ä¸€èˆ¬ç”¨æ¥ä¸“é—¨å¤„ç†å­—ç¬¦ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æ›¿æ¢æ‰ä¸€äº›ç±»ä¼¼äº'&#x3C;''>'å¯èƒ½æ¯”è¾ƒå±é™©çš„å­—ç¬¦é¢„å…ˆå¤„ç†(escape)è¾“å…¥æºã€‚</p>\\n<p>æ— è®ºå¦‚ä½•ï¼Œå¦‚æœäº§ç”Ÿè¿™ç§å®‰å…¨é—®é¢˜çš„ä»£ä»·è‡³ä»Šä¾ç„¶æ˜¯å·¨å¤§çš„ï¼Œä½†æ˜¯å¼€å‘è€…ä»¬ä¾ç„¶æ€»æœ‰æ—¶å€™ä¼šåœ¨å°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²è¾“å‡ºåˆ°é¡µé¢ä¸Šçš„æ—¶å€™å¿˜è®°æ‰è¿™äº›é—®é¢˜ã€‚<strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç°åœ¨è¿™äº›æµè¡Œçš„æ¡†æ¶æ¯”å¦‚Reactä¼šé»˜è®¤å¯¹å­—ç¬¦ä¸²é»˜è®¤åšescapeå¤„ç†</strong></p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>å¦‚æœ<code class=\\\"language-text\\\">message.text</code>æ˜¯ä¸€ä¸ªåŒ…å«<code class=\\\"language-text\\\">&lt;img&gt;</code>æˆ–è€…å…¶ä»–çš„ä»€ä¹ˆæ ‡ç­¾çš„æ”»å‡»æ€§å­—ç¬¦ä¸²ï¼Œä»–ä¸ä¼šè¢«è¿è¡Œæˆ<code class=\\\"language-text\\\">&lt;img&gt;</code>æ ‡ç­¾ã€‚Reactä¼šå…ˆescapeæ–‡æœ¬å†…å®¹ç„¶åæ’å…¥åˆ°DOMä¸­åŒºã€‚æ‰€ä»¥ä½ ä¸ä¼šçœ‹åˆ°ä¸€ä¸ª<code class=\\\"language-text\\\">&lt;img&gt;</code>æ ‡ç­¾ï¼Œä½ åªä¼šçœ‹åˆ°<code class=\\\"language-text\\\">&lt;img&gt;</code>çš„å­—ç¬¦ä¸²åœ¨é¡µé¢ä¸Šã€‚</p>\\n<p>å¦‚æœæƒ³è¦çœŸå®çš„HTMLæ¸²æŸ“åˆ°Reactå…ƒç´ ä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨<code class=\\\"language-text\\\">dangerouslySetInnerHTML={{ __html: message.text }}</code>ã€‚<strong>è™½ç„¶è¿™ä¹ˆå†™å¾ˆè ¢ï¼Œä½†è¿™ç¡®å®æ˜¯ä¸€ä¸ªåŠŸèƒ½</strong>ã€‚ å› ä¸ºè¿™æ ·ä¼šéå¸¸æ˜æ˜¾ï¼Œç„¶åä½ å°±èƒ½å¤Ÿåœ¨ä»£ç reviewæˆ–è€…ä»£ç åº“å®¡æŸ¥çš„æ—¶å€™æ›´æ–¹ä¾¿çš„æ³¨æ„åˆ°å®ƒã€‚</p>\\n<hr>\\n<p><strong>è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€Reactå¯¹äºè¿™ç§æ³¨å…¥çš„å·¥å…·å·²ç»å®Œå…¨å®‰å…¨äº†å‘¢ï¼Ÿä¸æ˜¯çš„</strong> HTMLå’ŒDOMè¿˜æä¾›äº†<a href=\\\"https://github.com/facebook/react/issues/3473#issuecomment-90594748\\\">å¾ˆå¤šæ”»å‡»çš„æ–¹å¼</a>ï¼Œä½†æ˜¯é˜²å¾¡è¿™äº›å¯¹äºReactæˆ–è€…å…¶ä»–çš„UIæ¡†æ¶æ¥è¯´æœ‰ä¸€å®šçš„éš¾åº¦ã€‚å¤§éƒ¨åˆ†å‰©ä¸‹çš„æ”»å‡»æ–¹å¼éƒ½æ¶‰åŠåœ¨attributesä¸­ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ¸²æŸ“ä¸€ä¸ª<code class=\\\"language-text\\\">&lt;a href={user.website}&gt;</code>ç»„ä»¶ï¼Œé‚£ä½ éœ€è¦é˜²èŒƒæœ‰äººä¼šè®¾ç½®websiteä¸º<code class=\\\"language-text\\\">&#39;javascript:stealYourPassword()&#39;</code>ã€‚ç»“æ„ç”¨æˆ·çš„è¾“å‡ºï¼Œæ¯”å¦‚<code class=\\\"language-text\\\">&lt;div {...userData}&gt;</code>è™½ç„¶è¿™å¯èƒ½å¾ˆå°‘å‡ºç°ä½†æ˜¯ä¹Ÿéå¸¸å±é™©ã€‚</p>\\n<p>éšç€æ—¶é—´æ¨ç§»ï¼ŒReact<a href=\\\"https://github.com/facebook/react/issues/10506\\\">å¯ä»¥</a>æä¾›æ›´å¤šçš„ä¿æŠ¤æªæ–½ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™éƒ½æ˜¯æœåŠ¡å™¨é€ æˆçš„é—®é¢˜ï¼Œè¿™äº›<a href=\\\"https://github.com/facebook/react/issues/3473#issuecomment-91327040\\\">åº”è¯¥</a>åœ¨æœåŠ¡å™¨ç«¯è¢«ä¿®å¤ã€‚</p>\\n<p>ç°å¦‚ä»Šï¼Œescapæ–‡æœ¬å†…å®¹æ˜¯ä¸€ä¸ªåˆç†çš„è§£å†³è¿™äº›éšè—æ”»å‡»çš„ç¬¬ä¸€é“é˜²çº¿ã€‚å½“ä½ çŸ¥é“ä¸‹é¢è¿™æ®µä»£ç æ˜¯å®‰å…¨çš„æ—¶å€™æ˜¯ä¸æ˜¯è¿˜æ˜¯å¬å®‰å¿ƒçš„ã€‚</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token comment\\\">// Escaped automatically</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p><strong>å¥½å§ï¼Œå…¶å®è¿™ä¹Ÿä¸æ˜¯çœŸçš„å®‰å…¨çš„</strong> æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äº†<code class=\\\"language-text\\\">$$typeof</code>ã€‚\\n<strong>Well, that wasnâ€™t always true either.</strong> And thatâ€™s where <code class=\\\"language-text\\\">$$typeof</code> comes in.</p>\\n<hr>\\n<p>Reactå…ƒç´ åœ¨è®¾è®¡çš„æ—¶å€™æ˜¯ä¸€ä¸ªçº¯å¯¹è±¡:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ ä¼šä½¿ç”¨<code class=\\\"language-text\\\">React.createElement()</code>æ¥åˆ›å»ºä¸€ä¸ªReactå…ƒç´ ï¼Œè¿™ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚\\nWhile normally you create them with <code class=\\\"language-text\\\">React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldnâ€™t <em>want</em> to write them like this â€” but this <a href=\\\"https://github.com/facebook/react/pull/3583#issuecomment-90296667\\\">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>\\n<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token comment\\\">// Server could have a hole that lets user store JSON</span>\\n<span class=\\\"gatsby-highlight-code-line\\\"><span class=\\\"token keyword\\\">let</span> expectedTextButGotJSON <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">    dangerouslySetInnerHTML<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">      __html<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'/* put your exploit here */'</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token comment\\\">// ...</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\"><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</span><span class=\\\"token keyword\\\">let</span> message <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> text<span class=\\\"token punctuation\\\">:</span> expectedTextButGotJSON <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Dangerous in React 0.13</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n</span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>In that case, React 0.13 would be <a href=\\\"http://danlec.com/blog/xss-via-a-spoofed-react-element\\\">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>\\n<p>The fix in React 0.14 was to <a href=\\\"https://github.com/facebook/react/pull/4832\\\">tag every React element with a Symbol</a>:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"gatsby-highlight-code-line\\\">  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This works because you canâ€™t just put <code class=\\\"language-text\\\">Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON canâ€™t include <code class=\\\"language-text\\\">Symbol.for(&#39;react.element&#39;)</code>.</strong> React will check <code class=\\\"language-text\\\">element.$$typeof</code>, and will refuse to process the element if itâ€™s missing or invalid.</p>\\n<p>The nice thing about using <code class=\\\"language-text\\\">Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesnâ€™t prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still â€œagreeâ€ on the valid <code class=\\\"language-text\\\">$$typeof</code> value.</p>\\n<hr>\\n<p>What about the browsers that <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility\\\">donâ€™t support</a> Symbols?</p>\\n<p>Alas, they donâ€™t get this extra protection. React still includes the <code class=\\\"language-text\\\">$$typeof</code> field on the element for consistency, but itâ€™s <a href=\\\"https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16\\\">set to a number</a> â€” <code class=\\\"language-text\\\">0xeac7</code>.</p>\\n<p>Why this number specifically? <code class=\\\"language-text\\\">0xeac7</code> kinda looks like â€œReactâ€.</p>\",\"frontmatter\":{\"title\":\"ç¿»è¯‘ï¼šä¸ºä»€ä¹ˆReactçš„å…ƒç´ æœ‰ä¸€ä¸ªå«åš$$typeofçš„å±æ€§\",\"date\":\"02 December, 2018\",\"tag\":\"translate,overreacted\"}}},\"pathContext\":{\"slug\":\"translate-overreacted-why-do-react-elements-have-typeof-property\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---posts-translate-overreacted-why-do-react-elements-have-typeof-property-46cb7284640e66747947.js","module.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<blockquote>\\n<p>æœ¬æ–‡å‡ºè‡ª<a href=\\\"https://overreacted.io/\\\">overreacted</a>ï¼Œè¿™æ˜¯<a href=\\\"https://mobile.twitter.com/dan_abramov\\\">Dan Abramov</a>å†™çš„åšå®¢ï¼Œæˆ‘è§‰å¾—å¯¹å¾ˆæœ‰ç”¨æ‰€ä»¥ç‰¹æ„åšäº†è¿™ä¸ªç¿»è¯‘<a href=\\\"/posts/overreacted\\\">ç³»åˆ—</a>ï¼ŒåŸæ–‡é“¾æ¥è¯·æŸ¥çœ‹<a href=\\\"https://overreacted.io/why-do-react-elements-have-typeof-property/\\\">è¿™é‡Œ</a></p>\\n</blockquote>\\n<p>æƒ³è±¡ä¸€ä¸‹å¦‚æœä½ ç¼–å†™äº†ä¸‹é¢çš„ä¸€æ®µä»£ç </p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>marquee</span> <span class=\\\"token attr-name\\\">bgcolor</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>#ffa7c4<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>hi<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>marquee</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>äº‹å®ä¸Šä½ æ˜¯åœ¨è°ƒç”¨è¿™æ ·ä¸€ä¸ªå‡½æ•°:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\">React<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token comment\\\">/* type */</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">/* props */</span> <span class=\\\"token punctuation\\\">{</span> bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">/* children */</span> <span class=\\\"token string\\\">'hi'</span>\\n<span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<p>è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä½ ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å«åšReactå…ƒç´ ã€‚Reactå¯ä»¥åœ¨ä¹‹åæ¸²æŸ“è¿™ä¸ªå…ƒç´ ï¼Œä½ çš„ç»„ä»¶ä¸€èˆ¬ä¼šè¿”å›è¿™ä¸ªå…ƒç´ çš„æ ‘å½¢ç»“æ„ã€‚</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// ğŸ§ è¿™æ˜¯ä¸ªä»€ä¹ˆ</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>å¦‚æœä½ ä½¿ç”¨è¿‡Reactï¼Œä½ å¯èƒ½ä¼šå¯¹<code class=\\\"language-text\\\">type</code>ï¼Œ<code class=\\\"language-text\\\">props</code>ï¼Œ<code class=\\\"language-text\\\">key</code>ï¼Œ<code class=\\\"language-text\\\">ref</code>è¿™äº›å±æ€§åå¾ˆç†Ÿæ‚‰ã€‚<strong>ä½†æ˜¯è¿™ä¸ª<code class=\\\"language-text\\\">$$typeof</code>æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿè€Œä¸”ä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ªSymbolç±»å‹çš„æ•°æ®</strong></p>\\n<p>è¿™åˆæ˜¯ä¸€ä¸ªä½ å…¶å®åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å¹¶ä¸éœ€è¦çŸ¥é“çš„Reactçš„çŸ¥è¯†ï¼Œä½†æ˜¯å½“ä½ çŸ¥é“äº†è¿™ä¸ªä¹‹åï¼Œä½ ä¼šè§‰å¾—è±ç„¶å¼€æœ—ã€‚è¿™ç¯‡æ–‡ç« ä¼šåŒ…å«ä¸€äº›æœ‰å…³å®‰å…¨çš„çŸ¥è¯†ã€‚å¯èƒ½æœ‰ä¸€å¤©ä½ ä¼šç¼–å†™ä½ è‡ªå·±çš„UIæ¡†æ¶ï¼Œä»Šå¤©è¿™äº›çŸ¥è¯†ä¼šå¯¹ä½ éå¸¸æœ‰ç”¨ã€‚æˆ‘ä¹Ÿå¸Œæœ›è¿™å¯¹ä½ ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>\\n<hr>\\n<p>åœ¨å®¢æˆ·ç«¯UIæ¡†æ¶æµè¡Œå¹¶åŠ ä¸Šä¸€äº›åŸºç¡€çš„é˜²å¾¡æªæ–½ä¹‹å‰ï¼Œå¤§å®¶æ™®éçš„åšæ³•æ˜¯ç»„ç»‡ä¸€ä¸ªhtmlä»£ç ï¼Œå¹¶æ’å…¥åˆ°domä¸­å»:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token keyword\\\">const</span> messageEl <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'message'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmessageEl<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'&lt;p>'</span> <span class=\\\"token operator\\\">+</span> message<span class=\\\"token punctuation\\\">.</span>text <span class=\\\"token operator\\\">+</span> <span class=\\\"token string\\\">'&lt;/p>'</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<p>è¿™æ ·åšä¸€èˆ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å‡å¦‚ä¸Šé¢çš„<code class=\\\"language-text\\\">messsage.text</code>æ˜¯åƒ<code class=\\\"language-text\\\">&#39;&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;&#39;</code>è¿™æ ·çš„å†…å®¹ã€‚<strong>ä½ ä¸ä¼šæ„¿æ„æŠŠæ‰€æœ‰çš„é™Œç”Ÿäººå‘é€çš„ä¿¡æ¯å…¨éƒ½æ¸²æŸ“åœ¨é¡µé¢ä¸Š</strong></p>\\n<p>(æœ‰è¶£çš„äº‹å®: å¦‚æœä½ åªä½¿ç”¨å®¢æˆ·ç«¯çš„æ¸²æŸ“ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª<a href=\\\"https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript\\\">è„šæœ¬</a>ä¸ä¼šè®©ä½ è¿è¡Œè¿™äº›javascriptã€‚ä½†æ˜¯åˆ«è®©è¿™äº›è®©ä½ å¯¹å®‰å…¨é—®é¢˜è¶Šæ¥è¶Šä¸æ˜æ„Ÿ)ã€‚</p>\\n<p>ä¸ºäº†é˜²æ­¢è¿™ç§æ”»å‡»ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨çš„APIæ¯”å¦‚<code class=\\\"language-text\\\">document.createTextNode()</code>æˆ–è€…<code class=\\\"language-text\\\">textContent</code>ï¼Œè¿™ç§å‡½æ•°ä¸€èˆ¬ç”¨æ¥ä¸“é—¨å¤„ç†å­—ç¬¦ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æ›¿æ¢æ‰ä¸€äº›ç±»ä¼¼äº'&#x3C;''>'å¯èƒ½æ¯”è¾ƒå±é™©çš„å­—ç¬¦é¢„å…ˆå¤„ç†(escape)è¾“å…¥æºã€‚</p>\\n<p>æ— è®ºå¦‚ä½•ï¼Œå¦‚æœäº§ç”Ÿè¿™ç§å®‰å…¨é—®é¢˜çš„ä»£ä»·è‡³ä»Šä¾ç„¶æ˜¯å·¨å¤§çš„ï¼Œä½†æ˜¯å¼€å‘è€…ä»¬ä¾ç„¶æ€»æœ‰æ—¶å€™ä¼šåœ¨å°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²è¾“å‡ºåˆ°é¡µé¢ä¸Šçš„æ—¶å€™å¿˜è®°æ‰è¿™äº›é—®é¢˜ã€‚<strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç°åœ¨è¿™äº›æµè¡Œçš„æ¡†æ¶æ¯”å¦‚Reactä¼šé»˜è®¤å¯¹å­—ç¬¦ä¸²é»˜è®¤åšescapeå¤„ç†</strong></p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>å¦‚æœ<code class=\\\"language-text\\\">message.text</code>æ˜¯ä¸€ä¸ªåŒ…å«<code class=\\\"language-text\\\">&lt;img&gt;</code>æˆ–è€…å…¶ä»–çš„ä»€ä¹ˆæ ‡ç­¾çš„æ”»å‡»æ€§å­—ç¬¦ä¸²ï¼Œä»–ä¸ä¼šè¢«è¿è¡Œæˆ<code class=\\\"language-text\\\">&lt;img&gt;</code>æ ‡ç­¾ã€‚Reactä¼šå…ˆescapeæ–‡æœ¬å†…å®¹ç„¶åæ’å…¥åˆ°DOMä¸­åŒºã€‚æ‰€ä»¥ä½ ä¸ä¼šçœ‹åˆ°ä¸€ä¸ª<code class=\\\"language-text\\\">&lt;img&gt;</code>æ ‡ç­¾ï¼Œä½ åªä¼šçœ‹åˆ°<code class=\\\"language-text\\\">&lt;img&gt;</code>çš„å­—ç¬¦ä¸²åœ¨é¡µé¢ä¸Šã€‚</p>\\n<p>å¦‚æœæƒ³è¦çœŸå®çš„HTMLæ¸²æŸ“åˆ°Reactå…ƒç´ ä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨<code class=\\\"language-text\\\">dangerouslySetInnerHTML={{ __html: message.text }}</code>ã€‚<strong>è™½ç„¶è¿™ä¹ˆå†™å¾ˆè ¢ï¼Œä½†è¿™ç¡®å®æ˜¯ä¸€ä¸ªåŠŸèƒ½</strong>ã€‚ å› ä¸ºè¿™æ ·ä¼šéå¸¸æ˜æ˜¾ï¼Œç„¶åä½ å°±èƒ½å¤Ÿåœ¨ä»£ç reviewæˆ–è€…ä»£ç åº“å®¡æŸ¥çš„æ—¶å€™æ›´æ–¹ä¾¿çš„æ³¨æ„åˆ°å®ƒã€‚</p>\\n<hr>\\n<p><strong>è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€Reactå¯¹äºè¿™ç§æ³¨å…¥çš„å·¥å…·å·²ç»å®Œå…¨å®‰å…¨äº†å‘¢ï¼Ÿä¸æ˜¯çš„</strong> HTMLå’ŒDOMè¿˜æä¾›äº†<a href=\\\"https://github.com/facebook/react/issues/3473#issuecomment-90594748\\\">å¾ˆå¤šæ”»å‡»çš„æ–¹å¼</a>ï¼Œä½†æ˜¯é˜²å¾¡è¿™äº›å¯¹äºReactæˆ–è€…å…¶ä»–çš„UIæ¡†æ¶æ¥è¯´æœ‰ä¸€å®šçš„éš¾åº¦ã€‚å¤§éƒ¨åˆ†å‰©ä¸‹çš„æ”»å‡»æ–¹å¼éƒ½æ¶‰åŠåœ¨attributesä¸­ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ¸²æŸ“ä¸€ä¸ª<code class=\\\"language-text\\\">&lt;a href={user.website}&gt;</code>ç»„ä»¶ï¼Œé‚£ä½ éœ€è¦é˜²èŒƒæœ‰äººä¼šè®¾ç½®websiteä¸º<code class=\\\"language-text\\\">&#39;javascript:stealYourPassword()&#39;</code>ã€‚ç»“æ„ç”¨æˆ·çš„è¾“å‡ºï¼Œæ¯”å¦‚<code class=\\\"language-text\\\">&lt;div {...userData}&gt;</code>è™½ç„¶è¿™å¯èƒ½å¾ˆå°‘å‡ºç°ä½†æ˜¯ä¹Ÿéå¸¸å±é™©ã€‚</p>\\n<p>éšç€æ—¶é—´æ¨ç§»ï¼ŒReact<a href=\\\"https://github.com/facebook/react/issues/10506\\\">å¯ä»¥</a>æä¾›æ›´å¤šçš„ä¿æŠ¤æªæ–½ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™éƒ½æ˜¯æœåŠ¡å™¨é€ æˆçš„é—®é¢˜ï¼Œè¿™äº›<a href=\\\"https://github.com/facebook/react/issues/3473#issuecomment-91327040\\\">åº”è¯¥</a>åœ¨æœåŠ¡å™¨ç«¯è¢«ä¿®å¤ã€‚</p>\\n<p>ç°å¦‚ä»Šï¼Œescapæ–‡æœ¬å†…å®¹æ˜¯ä¸€ä¸ªåˆç†çš„è§£å†³è¿™äº›éšè—æ”»å‡»çš„ç¬¬ä¸€é“é˜²çº¿ã€‚å½“ä½ çŸ¥é“ä¸‹é¢è¿™æ®µä»£ç æ˜¯å®‰å…¨çš„æ—¶å€™æ˜¯ä¸æ˜¯è¿˜æ˜¯å¬å®‰å¿ƒçš„ã€‚</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token comment\\\">// Escaped automatically</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p><strong>å¥½å§ï¼Œå…¶å®è¿™ä¹Ÿä¸æ˜¯çœŸçš„å®‰å…¨çš„</strong> æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äº†<code class=\\\"language-text\\\">$$typeof</code>ã€‚\\n<strong>Well, that wasnâ€™t always true either.</strong> And thatâ€™s where <code class=\\\"language-text\\\">$$typeof</code> comes in.</p>\\n<hr>\\n<p>Reactå…ƒç´ åœ¨è®¾è®¡çš„æ—¶å€™æ˜¯ä¸€ä¸ªçº¯å¯¹è±¡:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ ä¼šä½¿ç”¨<code class=\\\"language-text\\\">React.createElement()</code>æ¥åˆ›å»ºä¸€ä¸ªReactå…ƒç´ ï¼Œè¿™ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚\\nWhile normally you create them with <code class=\\\"language-text\\\">React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldnâ€™t <em>want</em> to write them like this â€” but this <a href=\\\"https://github.com/facebook/react/pull/3583#issuecomment-90296667\\\">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>\\n<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token comment\\\">// Server could have a hole that lets user store JSON</span>\\n<span class=\\\"gatsby-highlight-code-line\\\"><span class=\\\"token keyword\\\">let</span> expectedTextButGotJSON <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">    dangerouslySetInnerHTML<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">      __html<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'/* put your exploit here */'</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token comment\\\">// ...</span>\\n</span><span class=\\\"gatsby-highlight-code-line\\\"><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</span><span class=\\\"token keyword\\\">let</span> message <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> text<span class=\\\"token punctuation\\\">:</span> expectedTextButGotJSON <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Dangerous in React 0.13</span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"gatsby-highlight-code-line\\\">  <span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">.</span>text<span class=\\\"token punctuation\\\">}</span>\\n</span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<p>In that case, React 0.13 would be <a href=\\\"http://danlec.com/blog/xss-via-a-spoofed-react-element\\\">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>\\n<p>The fix in React 0.14 was to <a href=\\\"https://github.com/facebook/react/pull/4832\\\">tag every React element with a Symbol</a>:</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"jsx\\\">\\n      <pre class=\\\"language-jsx\\\"><code class=\\\"language-jsx\\\"><span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'marquee'</span><span class=\\\"token punctuation\\\">,</span>\\n  props<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    bgcolor<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'#ffa7c4'</span><span class=\\\"token punctuation\\\">,</span>\\n    children<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'hi'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  key<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n  ref<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"gatsby-highlight-code-line\\\">  $$<span class=\\\"token keyword\\\">typeof</span><span class=\\\"token punctuation\\\">:</span> Symbol<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'react.element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n</span><span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This works because you canâ€™t just put <code class=\\\"language-text\\\">Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON canâ€™t include <code class=\\\"language-text\\\">Symbol.for(&#39;react.element&#39;)</code>.</strong> React will check <code class=\\\"language-text\\\">element.$$typeof</code>, and will refuse to process the element if itâ€™s missing or invalid.</p>\\n<p>The nice thing about using <code class=\\\"language-text\\\">Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesnâ€™t prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still â€œagreeâ€ on the valid <code class=\\\"language-text\\\">$$typeof</code> value.</p>\\n<hr>\\n<p>What about the browsers that <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility\\\">donâ€™t support</a> Symbols?</p>\\n<p>Alas, they donâ€™t get this extra protection. React still includes the <code class=\\\"language-text\\\">$$typeof</code> field on the element for consistency, but itâ€™s <a href=\\\"https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16\\\">set to a number</a> â€” <code class=\\\"language-text\\\">0xeac7</code>.</p>\\n<p>Why this number specifically? <code class=\\\"language-text\\\">0xeac7</code> kinda looks like â€œReactâ€.</p>\",\"frontmatter\":{\"title\":\"ç¿»è¯‘ï¼šä¸ºä»€ä¹ˆReactçš„å…ƒç´ æœ‰ä¸€ä¸ªå«åš$$typeofçš„å±æ€§\",\"date\":\"02 December, 2018\",\"tag\":\"translate,overreacted\"}}},\"pathContext\":{\"slug\":\"translate-overreacted-why-do-react-elements-have-typeof-property\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/posts-translate-overreacted-why-do-react-elements-have-typeof-property.json\n// module id = 379\n// module chunks = 99838320125203"],"sourceRoot":""}